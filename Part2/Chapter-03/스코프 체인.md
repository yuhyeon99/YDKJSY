> **3장의 진도를 나가기 전에 주위에 한 사람을 붙들고 글이나 말로 여러분만의 언어를 사용해 
렉시컬 스코프란 무엇인지, 렉시컬 스코프를 이해하는 게 
왜 중요한지 설명해보길 바랍니다.**
> 
- **렉시컬 스코프란** 코드가 작성될 때 스코프(블록, 함수)에 정의(=선언)된 변수나 식별자가 등록되어 해당 스코프 혹은 하위 스코프에서 참조할 수 있게 정해진 규칙입니다.
- **왜 중요한가?** 코드를 작성할 때 렉시컬 스코프가 클로저, 스코프 체이닝처럼 변수 참조가 중요한 개념들을 더 명확하게 다룰 수 있고, 호이스팅이 어떻게 작동하는지 이해하는데도 큰 도움이 되기 때문입니다.

### 스코프 체인

- 스코프와 중첩 스코프 사이에 맺어진 연결을 스코프 체인(scope chain)이라고 한다.
- 체인은 변수 탐색 경로가 위 혹은 바깥쪽으로만 향하도록 지시받습니다.

### 3.1 탐색의 진실

- **탐색이란?**
    - 런타임 때 변수에 접근하는 과정
- **탐색 과정:**
    1. **참조**를 만났을 때 **엔진**은 현재 스코프를 관리하는 **스코프 매니저**에게 알고 있는 **식별자 혹은 변수인지 물어본다.**
    2. 원하는 식별자 혹은 변수를 찾을 때까지 중첩 스코프를 따라 올라가며 전역 스코프를 만날 때까지 탐색한다.**(발견하면 즉시 탐색을 중단한다)**
- [지금까지 살펴본 런타임 검색 프로세스](https://www.notion.so/CHAPTER-3-12ec7bdaffa480868bd9c633bfecd7cd?pvs=21)는 개념을 이해하는 데는 도움을 주지만 실제 탐색 프로세스와는 다릅니다.
    - **구슬을 담은 양동이의 색**(변수가 어떤 스코프에서 왔는지 알려주는 메타 정보)은 보통 **컴파일 과정 초기에 결정**됩니다.
    - **렉시컬 스코프는 컴파일 초기에 확정**되므로 구슬 색은 런타임 상황에 영향을 받지 않습니다.
    - 구슬 색 역시 컴파일레이션 때 확정되고 변하지 않기 때문에 **구슬 색에 관한 정보는 `AST(= Abstract Syntax Tree, 추상 구문 트리)`에 있는 각 변수(혹은 접근 가능한 변수) 정보와 함께 저장**됩니다.
- **정리:**
    - JS 엔진은 변수가 속한 양동이 정보를 이미 알고 있어서 탐색할 필요가 없음
    - 런타임에 탐색을 할 필요가 없다는 점은 최적화 관점에서 렉시컬 스코프가 가져다주는 중요한 혜택
    - 현재 파일에서 접근 가능한 렉시컬 스코프 어디에도 참조가 불가능한 변수가 있을 때(다른 모듈 파일)
        - 이런 경우도 있기 때문에 탐색 과정에서 선언을 찾지 못해도 오류가 발생하는 것은 아님
        - 런타임에 다른 파일(프로그램)이 해당 변수를 전역에 선언할 가능성도 있기 때문.
        - 이런 이유 때문에 접근 가능한 양동이에 원하는 변수가 선언되었는지 여부는 컴파일 타임이 아닌 런타임에 완전히 확정된다고 할 수 있음
        - 선언하지 않은 변수에 대한 참조는 해당 파일을 컴파일하는 동안에는 색이 지정되지 않습니다.
        ⇒ 연관 파일들을 컴파일하고 애플리케이션 실행 직전까지 구슬 색이 지정되지 않음.
    - 탐색이 지연되는 경우는 변수가 발견되는 범위(주로 전역 스코프)를 기준으로 색이 정해집니다.

### 3.2 변수 섀도잉

- 식별자 이름이 겹치지 않을 때는 전부를 전역 스코프에 담아도 괜찮을 수 있음.
- 이름이 같은 변수를 꼭 두 개 이상 사용해야 한다면 스코프를 반드시 분리(중첩 스코프 등)해야합니다.
- 예시 코드:
    
    ```jsx
    var studentName = "MangPoo";// 빨간색 양동이
    
    function printStudent(studentName) { // 파란색 양동이
    	studentName = studentName.toUpperCase();
    	console.log(studentName);
    }
    
    printStudent("Paul");
    // PAUL
    
    printStudent(studentName);
    // MangPoo
    
    console.log(studentName);
    // MangPoo
    ```
    
    - 변수 탐색은 현재 스코프부터 시작해서 바깥과 위를 향해 스코프를 점차 넓혀가며 진행되다가 일치하는 변수를 찾으면 중단
    - `printStudent(”Paul”);` 에서 파란색 `studentName`을 찾으면 바로 탐색이 중단되는 렉시컬 스코프의 주요 특징
    - 이를 **섀도잉**이라고 합니다.
